---
title: "Transition Curve Fitting Tool: Results"
output: pdf_document
params:
  plot_fits_out: NA
  coef_table_out: NA
  fit_metrics_table_out: NA
  dbtt_table_out: NA
  plot_tpout_out: NA
  plot_resids: NA 
  other_vars: NA
  results: NA

  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r results='asis'}
cat(paste('# User Information:',other_vars$userID,'\n'))
cat(paste('## Date:', Sys.Date(),'\n'))
```



```{r results='asis'}
cat("**Starting Values for Optimization** \n\n")

for(ii in 1:length(other_vars$start)) {
  cat(paste("Model:",correct_names(names(other_vars$start)[ii])))
  cat('\n')
  just_vals = other_vars$start[[ii]]
  names(just_vals) = NULL
  print(knitr::kable(data.frame(parameter=names(other_vars$start[[ii]]),initial_value=just_vals)))
  cat('\n')
}
```

```{r results='asis'}
cat('**Shelf selection**: ')
if(other_vars$shelves == 'bsf') {
  cat(paste("Both shelves wer set to be fixed. The upper shelf was set to be ",other_vars$upper_shelf,
            " and the lower shelf to be ",other_vars$lower_shelf,".\n\n",sep=""))
} else if(other_vars$shelves == 'snf') {
    cat(paste("Both shelves were set to be not fixed.",
              " The upper shelf was initialized to be ",other_vars$upper_shelf,
              " and the lower shelf was initialized to be ",other_vars$lower_shelf,".\n\n",sep=""))
} else if(other_vars$shelves == 'usf') {
    cat(paste("The upper shelf was set to be fixed, and the lower shelf was set to be not fixed.",
              " The upper shelf value was assumed to be ",other_vars$upper_shelf,
              " and the lower shelf was initialized at ",other_vars$lower_shelf,".\n\n",sep=""))
} else if(other_vars$shelves == 'lsf') {
    cat(paste("The upper shelf was set to be not fixed, and the lower shelf was set to be fixed.",
              " The upper shelf value was initialized at ",other_vars$upper_shelf,
              " and the lower shelf was set to be ",other_vars$lower_shelf,".\n\n",sep=""))
}
```

## Fitted Plot
```{r}
plot_fits_out
```

\newpage

## Coefficients Table
```{r}
knitr::kable(coef_table_out)
```

## Fit Metrics Table
```{r}
knitr::kable(fit_metrics_table_out)
```


## DBTT Table
```{r}
knitr::kable(dbtt_table_out)
```


## Other Characteristic Temperatures
```{r}
if(!is.null(plot_tpout_out)) {
  knitr::kable(plot_tpout_out)
} else {
  cat("No additional characteristic temperatures selected.")
}

```

\newpage

## Residuals
```{r results='asis',fig.height=7}
models = names(results)

for(ii in 1:length(models)) {
  cat('### Model: ',correct_names(models[ii]))
  cat('\n\n')
  plot_resids_md(other_vars,results,models[ii])
  cat('\n\n')
  cat('\n\n\\newpage')
  cat('\n\n')
}
```